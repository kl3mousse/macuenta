<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>macuenta — webxdc</title>
    <link rel="icon" href="icon.png" />
    <script src="webxdc.js"></script>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-bar" role="banner">
      <div class="app-bar-inner">
        <div class="app-bar-left">
          <img src="logo.png" alt="macuenta logo" class="app-bar-logo" />
        </div>
        <h1 class="app-bar-title" aria-level="1" role="heading">ma Cuenta</h1>
        <div class="app-bar-right">
          <button id="ledger-btn" class="app-bar-icon-btn" type="button" aria-label="View ledger" title="Ledger" onclick="window.__openLedger && window.__openLedger()">📜</button>
        </div>
      </div>
    </header>
    <section id="onboarding-screen" class="onboarding" hidden>
      <header class="onboarding-app-bar">
        <div class="onboarding-app-bar-inner">
          <div class="onboarding-app-bar-left">
            <img src="logo.png" alt="macuenta logo" class="onboarding-app-logo" />
          </div>
          <h1 class="onboarding-app-title">ma Cuenta</h1>
          <div class="onboarding-app-bar-right"></div>
        </div>
      </header>
      <div class="onboarding-description">
        <p>Track shared expenses effortlessly with friends, family, or colleagues. Split costs fairly, see who owes what, and settle up without the hassle of manual calculations.</p>
      </div>
      <div class="onboarding-content">
        <div class="onboarding-card" role="dialog" aria-labelledby="onboarding-title-heading">
          <header class="onboarding-head">
            <h2 id="onboarding-title-heading">Set up your trip</h2>
          </header>
          <label class="onboarding-field" for="onboarding-title">
            <span class="onboarding-label">Trip title</span>
            <input id="onboarding-title" type="text" maxlength="60" placeholder="Weekend in Montmartre" autocomplete="off" />
          </label>
          <label class="onboarding-field" for="onboarding-currency">
            <span class="onboarding-label">Currency</span>
            <select id="onboarding-currency">
              <option value="EUR" selected>EUR — Euro (€)</option>
              <option value="USD">USD — US Dollar ($)</option>
              <option value="GBP">GBP — Pound (£)</option>
              <option value="CHF">CHF — Swiss Franc</option>
            </select>
          </label>
          <div class="onboarding-field">
            <span class="onboarding-label">Participants</span>
            <div id="onboarding-participant-chips" class="onboarding-chip-list" role="list" style="display: none;"></div>
            <div class="onboarding-add">
              <input id="onboarding-participant-input" type="text" maxlength="60" placeholder="Add a name" autocomplete="off" />
              <button type="button" id="onboarding-add-participant" class="secondary-btn onboarding-add-btn">Add</button>
            </div>
          </div>
          <button type="button" id="onboarding-start" class="primary-btn onboarding-start" onclick="window.__startTracking && window.__startTracking()">Start tracking</button>
        </div>
      </div>
    </section>

    <main class="app-main">
      <section class="app-shell">
        <header class="hero-card" aria-labelledby="group-name">
          <div class="hero-card-inner hero-card-centered">
            <h1 class="hero-title" id="group-name" title="macuenta">macuenta</h1>
            <p id="header-subtitle" class="hero-total" aria-live="polite">0.00 €</p>
            <button id="participants-summary" class="hero-participants-summary" type="button" aria-label="Trip settings">
              <span class="participants-summary-count" id="participants-summary-text">Add participants</span>
              <span class="participants-summary-icon" aria-hidden="true">›</span>
            </button>
          </div>
        </header>

        <nav class="tab-bar top" id="tab-bar" aria-label="Primary">
          <div class="tab-pill-group">
            <button class="tab-btn is-active" data-tab-target="expenses">Expenses</button>
            <button class="tab-btn" data-tab-target="balance">Balance</button>
            <button class="tab-btn" data-tab-target="reimburse">Reimburse</button>
          </div>
        </nav>

        <div id="content" class="content-area">
          <!-- Expenses View -->
          <div id="view-expenses" class="app-view is-active" data-tab="expenses">
            <section class="section-block">
              <header class="section-header">
                <h2 class="section-title">Expenses</h2>
              </header>
              <div id="expenses-empty" class="empty-state">
                <div class="empty-illustration" aria-hidden="true">🧾</div>
                <p class="empty-title">No expenses yet</p>
                <p class="empty-subtitle">Start by adding your first one.</p>
                <button type="button" class="primary-btn empty-cta" onclick="window.__openExpenseSheet && window.__openExpenseSheet()">Add expense</button>
              </div>
              <ul id="expenses-list" class="expense-list" role="list"></ul>
            </section>
          </div>

          <!-- Balance View -->
          <div id="view-balance" class="app-view" data-tab="balance" hidden>
            <section class="section-block">
              <header class="section-header">
                <h2 class="section-title">Balance</h2>
              </header>
              <div id="balance-chart" class="balance-chart" aria-hidden="true"></div>
              <ul id="balances-list" class="balance-list" role="list"></ul>
              <p id="no-balances-hint" class="section-hint">Balances appear after adding expenses.</p>
            </section>
          </div>

          <!-- Reimburse View -->
          <div id="view-reimburse" class="app-view" data-tab="reimburse" hidden>
            <section class="section-block">
              <header class="section-header">
                <h2 class="section-title">Settle up</h2>
              </header>
              <ul id="settlements-list" class="settlement-list" role="list"></ul>
              <p id="no-settlements-hint" class="section-hint">All settled.</p>
            </section>
            <section class="section-block">
              <header class="section-header">
                <h2 class="section-title">Completed transfers</h2>
              </header>
              <ul id="completed-settlements-list" class="settlement-list is-secondary" role="list"></ul>
              <p id="no-completed-settlements-hint" class="section-hint">None yet.</p>
            </section>
          </div>
        </div>
      </section>
    </main>

    <button id="fab-add" class="fab" aria-label="Add expense">＋</button>

    <!-- Category Grid Popover -->
    <div class="popover-backdrop" id="category-popover-backdrop" hidden></div>
    <div class="category-popover" id="category-popover" aria-hidden="true" role="dialog" aria-labelledby="category-popover-title">
      <div class="popover-header">
        <h3 id="category-popover-title">Choose Category</h3>
        <button type="button" class="icon-btn close-btn" id="category-popover-close" aria-label="Close">✕</button>
      </div>
      <div class="category-grid" id="category-grid">
        <!-- Category icons will be populated by JavaScript -->
      </div>
    </div>

    <div class="sheet-backdrop" id="expense-sheet-backdrop" hidden></div>
    <aside class="bottom-sheet" id="expense-sheet" aria-hidden="true" aria-labelledby="sheet-title" role="dialog">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <h2 id="sheet-title">Add Expense</h2>
        <button type="button" class="icon-btn close-btn" id="sheet-close" aria-label="Close">✕</button>
      </div>
      <form id="expense-form" autocomplete="off" class="sheet-form">
        <!-- Main Details -->
        <div class="form-section">
            <!-- Title with Integrated Category Icon -->
            <div class="form-field">
              <div class="pill-input title-pill">
                <button type="button" class="input-icon-square category-icon-square" id="title-category-icon-btn" aria-label="Select category">
                  <span class="input-prefix-icon" id="title-category-icon"></span>
                </button>
                <input id="exp-title" required maxlength="140" placeholder="What did you pay for?" />
              </div>
            </div>
            
            <!-- Amount with Integrated Currency -->
            <div class="form-field">
              <div class="pill-input amount-pill">
                <div class="input-icon-square">
                  <span class="currency-symbol" id="amount-currency-symbol">€</span>
                </div>
                <input id="exp-amount" required type="number" min="0.01" step="0.01" placeholder="0.00" />
                <select id="exp-currency" class="currency-dropdown">
                  <option value="EUR">EUR</option>
                  <option value="USD">USD</option>
                  <option value="GBP">GBP</option>
                  <option value="CHF">CHF</option>
                </select>
              </div>
            </div>
            
            <!-- Date Picker Pill -->
            <div class="form-field">
              <div class="pill-input date-pill" id="date-pill-wrapper">
                <button type="button" class="input-icon-square date-icon-square" id="date-icon-btn" aria-label="Select date">
                  <span class="calendar-icon-svg" id="calendar-icon-svg"></span>
                </button>
                <span class="date-display-text" id="date-display-text">Today</span>
                <input id="exp-date" type="date" required class="date-input-field" />
              </div>
            </div>
        </div>

        <!-- Who pays? Section -->
        <div class="form-section">
          <h3 class="section-header">Who paid?</h3>
          <div class="payer-selector" id="payer-selector">
            <!-- Participant pills will be populated by JavaScript -->
          </div>
          <select id="exp-payer" class="fld-select" required style="display: none;">
            <option value="" selected>Select payer…</option>
          </select>
        </div>

        <!-- How to split? Section -->
        <div class="form-section">
          <h3 class="section-header">How to split?</h3>
            
            <!-- Split Mode Toggle Buttons -->
            <div class="split-mode-toggles" id="split-mode-toggles">
              <button type="button" class="split-toggle-btn active" data-mode="even">
                <span class="split-icon">⚖️</span>
                <span class="split-label">Equal</span>
              </button>
              <button type="button" class="split-toggle-btn" data-mode="weight">
                <span class="split-icon">📊</span>
                <span class="split-label">Weight</span>
              </button>
              <button type="button" class="split-toggle-btn" data-mode="manual">
                <span class="split-icon">✏️</span>
                <span class="split-label">Custom</span>
              </button>
            </div>
            <select id="split-mode" style="display: none;">
              <option value="even" selected>Even</option>
              <option value="weight">Weight</option>
              <option value="manual">Manual</option>
              <option value="mixed">Mixed (Manual + Weight/Even)</option>
            </select>
            
            <div id="split-config" class="split-config-box">
              <p class="split-helper-text">Evenly split among 3 participant(s).</p>
            </div>
        </div>

        <!-- Sticky Bottom Button -->
        <div class="sticky-bottom-actions">
          <button type="submit" class="primary-btn large-btn">Add Expense</button>
        </div>
        
        <!-- Hidden actions for compatibility -->
        <div class="sheet-actions" style="display: none;">
          <button type="button" class="secondary-btn" id="sheet-cancel">Cancel</button>
          <button type="submit" class="primary-btn">Save</button>
        </div>
      </form>
    </aside>

    <div class="sheet-backdrop" id="participants-sheet-backdrop" hidden></div>
    <aside class="bottom-sheet participants-sheet" id="participants-sheet" aria-hidden="true" aria-labelledby="participants-sheet-title" role="dialog">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header participants-sheet-header">
        <h2 id="participants-sheet-title">Trip Settings</h2>
        <button type="button" class="icon-btn close-btn" id="participants-sheet-close" aria-label="Close">✕</button>
      </div>
      <div class="participants-sheet-body" role="document">
        <div class="trip-settings-section">
          <h3 class="trip-settings-section-title">Trip Details</h3>
          <div class="trip-name-edit">
            <label for="trip-name-input" class="trip-name-label">Trip name</label>
            <div class="trip-name-input-group">
              <input id="trip-name-input" type="text" maxlength="60" placeholder="Enter trip name..." autocomplete="off" />
              <button type="button" class="primary-btn trip-name-save-btn" id="trip-name-save-btn">Save</button>
            </div>
          </div>
        </div>
        
        <div class="trip-settings-section">
          <h3 class="trip-settings-section-title">Participants</h3>
          <div class="participants-add-section">
            <div class="participants-add-input">
              <input id="participant-name-input" type="text" maxlength="60" placeholder="Add participant name..." autocomplete="off" />
              <button type="button" class="primary-btn participants-add-btn" id="participants-add-btn">Add</button>
            </div>
          </div>
          <div class="participants-section">
            <p class="participants-hint" id="participants-sheet-empty">Add people to split expenses.</p>
            <ul id="participants-list" class="participants-list" role="list"></ul>
          </div>
        </div>
      </div>
    </aside>

    <!-- Payment Preferences Sheet -->
    <div class="sheet-backdrop" id="payment-preferences-sheet-backdrop" hidden></div>
    <aside class="bottom-sheet payment-preferences-sheet" id="payment-preferences-sheet" aria-hidden="true" aria-labelledby="payment-preferences-sheet-title" role="dialog">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <h2 id="payment-preferences-sheet-title">Payment Preferences</h2>
        <button type="button" class="icon-btn close-btn" id="payment-preferences-sheet-close" aria-label="Close">✕</button>
      </div>
      <form id="payment-preferences-form" autocomplete="off" class="sheet-form">
        <div class="payment-preferences-participant-info">
          <div class="payment-preferences-participant-avatar" id="payment-preferences-avatar"></div>
          <h3 id="payment-preferences-participant-name">Participant Name</h3>
        </div>
        
        <div class="payment-method-section">
          <h4 class="payment-method-section-title">Primary Payment Method</h4>
          <label class="fld">
            <span class="fld-label">Method</span>
            <select id="primary-payment-method" class="fld-select">
              <option value="">Select method...</option>
              <option value="paypal">PayPal</option>
              <option value="revolut">Revolut</option>
              <option value="iban">IBAN</option>
              <option value="cash">Cash</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label class="fld" id="primary-payment-details-field">
            <span class="fld-label" id="primary-payment-details-label">Details</span>
            <input id="primary-payment-details" type="text" placeholder="Enter details..." />
            <span class="fld-error" id="primary-payment-details-error"></span>
          </label>
        </div>

        <div class="payment-method-section">
          <h4 class="payment-method-section-title">Secondary Payment Method <span class="payment-method-optional">(Optional)</span></h4>
          <label class="fld">
            <span class="fld-label">Method</span>
            <select id="secondary-payment-method" class="fld-select">
              <option value="">Select method...</option>
              <option value="paypal">PayPal</option>
              <option value="revolut">Revolut</option>
              <option value="iban">IBAN</option>
              <option value="cash">Cash</option>
              <option value="other">Other</option>
            </select>
          </label>
          <label class="fld" id="secondary-payment-details-field">
            <span class="fld-label" id="secondary-payment-details-label">Details</span>
            <input id="secondary-payment-details" type="text" placeholder="Enter details..." />
            <span class="fld-error" id="secondary-payment-details-error"></span>
          </label>
        </div>

        <div class="sheet-actions">
          <button type="button" class="secondary-btn" id="payment-preferences-cancel">Cancel</button>
          <button type="submit" class="primary-btn">Save</button>
        </div>
      </form>
    </aside>

    <script src="i18n.js"></script>
    <script src="main.js"></script>
    <div id="toast-stack" class="toast-stack" aria-live="polite"></div>

    <!-- Settlement Confirmation Sheet -->
    <div class="sheet-backdrop" id="settlement-sheet-backdrop" hidden></div>
    <aside class="bottom-sheet" id="settlement-sheet" aria-hidden="true" aria-labelledby="settlement-sheet-title" role="dialog">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <h2 id="settlement-sheet-title">Record Transfer</h2>
        <button type="button" class="icon-btn close-btn" id="settlement-sheet-close" aria-label="Close">✕</button>
      </div>
      <form id="settlement-form" autocomplete="off" class="sheet-form">
        <div class="fld">
          <span class="fld-label">From / To</span>
          <div class="settle-direction-row">
            <select id="settle-from" class="fld-select"></select>
            <button type="button" id="settle-swap" class="ghost-btn" aria-label="Swap direction" style="align-self:flex-end;">⇄</button>
            <select id="settle-to" class="fld-select"></select>
          </div>
        </div>
        <label class="fld">
          <span class="fld-label">Amount (<span id="settle-currency">EUR</span>)</span>
          <input id="settle-amount" type="number" min="0.01" step="0.01" required placeholder="0.00" />
        </label>
        <label class="fld">
          <span class="fld-label">Date</span>
          <input id="settle-date" type="date" required />
        </label>
        <div class="sheet-actions">
          <button type="button" class="secondary-btn" id="settle-cancel">Cancel</button>
          <button type="submit" class="primary-btn" id="settle-save">Save</button>
        </div>
      </form>
    </aside>

    <!-- Ledger Sheet -->
    <div class="sheet-backdrop" id="ledger-sheet-backdrop" hidden></div>
    <aside class="bottom-sheet" id="ledger-sheet" aria-hidden="true" aria-labelledby="ledger-sheet-title" role="dialog">
      <div class="sheet-handle" aria-hidden="true"></div>
      <div class="sheet-header">
        <h2 id="ledger-sheet-title">Ledger</h2>
        <button type="button" class="icon-btn close-btn" id="ledger-sheet-close" aria-label="Close ledger">✕</button>
      </div>
      <div class="sheet-form" style="gap:10px;">
        <p id="ledger-empty" style="font-size:12px; color:var(--c-muted); margin:4px 0; display:none;">No entries yet.</p>
        <ul id="ledger-list" class="ledger-list" role="list" aria-label="All expenses and settlements"></ul>
      </div>
    </aside>
  </body>
</html>
